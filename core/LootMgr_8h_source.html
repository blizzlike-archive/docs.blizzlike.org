<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>blizzlike core: src/game/LootMgr.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">blizzlike core
   </div>
   <div id="projectbrief">mmorpg server</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_1699be727a800b1d059c6f7f2b91d2ee.html">game</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">LootMgr.h</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (C) 2005-2011 MaNGOS &lt;http://getmangos.com/&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * Copyright (C) 2009-2011 MaNGOSZero &lt;https://github.com/mangos/zero&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Copyright (C) 2011-2016 Nostalrius &lt;https://nostalrius.org&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * Copyright (C) 2016-2017 Elysium Project &lt;https://github.com/elysium-project&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * This program is free software; you can redistribute it and/or modify</span></div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * it under the terms of the GNU General Public License as published by</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * the Free Software Foundation; either version 2 of the License, or</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * (at your option) any later version.</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span></div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> */</span></div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#ifndef MANGOS_LOOTMGR_H</span></div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#define MANGOS_LOOTMGR_H</span></div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;ItemEnchantmentMgr.h&quot;</span></div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;ByteBuffer.h&quot;</span></div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;ObjectGuid.h&quot;</span></div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;Utilities/LinkedReference/RefManager.h&quot;</span></div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &quot;SharedDefines.h&quot;</span></div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;map&gt;</span></div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;vector&gt;</span></div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#define MAX_NR_LOOT_ITEMS 16</span></div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">// note: the client cannot show more than 16 items total</span></div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#define MAX_NR_QUEST_ITEMS 32</span></div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment">// unrelated to the number of quest items shown, just for reserve</span></div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="keyword">enum</span> PermissionTypes</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;{</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;    ALL_PERMISSION              = 0,</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    GROUP_PERMISSION            = 1,</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    MASTER_PERMISSION           = 2,</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    ROUND_ROBIN_PERMISSION      = 3,</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    OWNER_PERMISSION            = 4,</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    NONE_PERMISSION             = 5,</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;};</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="keyword">enum</span> LootType</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;{</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;    LOOT_CORPSE                 = 1,</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    LOOT_PICKPOCKETING          = 2,</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    LOOT_FISHING                = 3,</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    LOOT_DISENCHANTING          = 4,</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                                                            <span class="comment">// ignored always by client</span></div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    LOOT_SKINNING               = 6,                        <span class="comment">// unsupported by client, sending LOOT_PICKPOCKETING instead</span></div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;    LOOT_FISHINGHOLE            = 20,                       <span class="comment">// unsupported by client, sending LOOT_FISHING instead</span></div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    LOOT_FISHING_FAIL           = 21,                       <span class="comment">// unsupported by client, sending LOOT_FISHING instead</span></div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    LOOT_INSIGNIA               = 22                        <span class="comment">// unsupported by client, sending LOOT_CORPSE instead</span></div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;};</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">/*</span></div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">// MaNGOSZero:</span></div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">enum LootSlotType</span></div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">{</span></div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">    LOOT_SLOT_NORMAL  = 0,                                  // can be looted</span></div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="comment">    LOOT_SLOT_VIEW    = 1,                                  // can be only view (ignore any loot attempts)</span></div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="comment">    LOOT_SLOT_MASTER  = 2,                                  // can be looted only master (error message)</span></div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="comment">    LOOT_SLOT_REQS    = 3,                                  // can&#39;t be looted (error message about missing reqs)</span></div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="comment">    MAX_LOOT_SLOT_TYPE                                      // custom, use for mark skipped from show items</span></div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="comment">};</span></div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">*/</span></div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment">// TrinityCore</span></div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">enum</span> LootSlotType</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;{</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    LOOT_SLOT_TYPE_ALLOW_LOOT   = 0,                        <span class="comment">// player can loot the item.</span></div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    LOOT_SLOT_TYPE_ROLL_ONGOING = 1,                        <span class="comment">// roll is ongoing. player cannot loot.</span></div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    LOOT_SLOT_TYPE_MASTER       = 2,                        <span class="comment">// item can only be distributed by group loot master.</span></div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    LOOT_SLOT_TYPE_LOCKED       = 3,                        <span class="comment">// item is shown in red. player cannot loot.</span></div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    LOOT_SLOT_TYPE_OWNER        = 4,                        <span class="comment">// ignore binding confirmation and etc, for single player looting</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    MAX_LOOT_SLOT_TYPE,</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;};</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">class </span><a class="code" href="classPlayer.html">Player</a>;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keyword">class </span><a class="code" href="classWorldObject.html">WorldObject</a>;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keyword">class </span><a class="code" href="classLootStore.html">LootStore</a>;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keyword">struct </span><a class="code" href="structLoot.html">Loot</a>;</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div><div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="structLootStoreItem.html">   91</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structLootStoreItem.html">LootStoreItem</a></div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;{</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    uint32  itemid;                                         <span class="comment">// id of the item</span></div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordtype">float</span>   chance;                                         <span class="comment">// always positive, chance to drop for both quest and non-quest items, chance to be used for refs</span></div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;    int32   mincountOrRef;                                  <span class="comment">// mincount for drop items (positive) or minus referenced TemplateleId (negative)</span></div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;    uint8   group       :7;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    <span class="keywordtype">bool</span>    needs_quest :1;                                 <span class="comment">// quest drop (negative ChanceOrQuestChance in DB)</span></div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    uint8   maxcount    :8;                                 <span class="comment">// max drop count for the item (mincountOrRef positive) or Ref multiplicator (mincountOrRef negative)</span></div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    uint16  conditionId :16;                                <span class="comment">// additional loot condition Id</span></div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="comment">// Constructor, converting ChanceOrQuestChance -&gt; (chance, needs_quest)</span></div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="comment">// displayid is filled in IsValid() which must be called after</span></div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="structLootStoreItem.html">LootStoreItem</a>(uint32 _itemid, <span class="keywordtype">float</span> _chanceOrQuestChance, int8 _group, uint16 _conditionId, int32 _mincountOrRef, uint8 _maxcount)</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        : itemid(_itemid), chance(fabs(_chanceOrQuestChance)), mincountOrRef(_mincountOrRef),</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        group(_group), needs_quest(_chanceOrQuestChance &lt; 0), maxcount(_maxcount), conditionId(_conditionId)</div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;         {}</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="classRoll.html">Roll</a>(<span class="keywordtype">bool</span> rate) <span class="keyword">const</span>;                                <span class="comment">// Checks if the entry takes it&#39;s chance (at loot generation)</span></div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordtype">bool</span> IsValid(<a class="code" href="classLootStore.html">LootStore</a> <span class="keyword">const</span>&amp; store, uint32 entry) <span class="keyword">const</span>;  <span class="comment">// Checks correctness of values</span></div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;    <span class="keywordtype">bool</span> AllowedForTeam(<a class="code" href="structLoot.html">Loot</a> <span class="keyword">const</span>&amp; loot) <span class="keyword">const</span>;               <span class="comment">// Checks item group compatibility</span></div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;};</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="keyword">typedef</span> std::set&lt;uint32&gt; AllowedLooterSet;</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;</div><div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="structLootItem.html">  115</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structLootItem.html">LootItem</a></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;    uint32  itemid;</div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    int32   randomPropertyId;</div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;    uint16  conditionId       :16;                          <span class="comment">// allow compiler pack structure</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    uint8   count             : 8;</div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <span class="keywordtype">bool</span>    is_looted         : 1;</div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;    <span class="keywordtype">bool</span>    is_blocked        : 1;</div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    <span class="keywordtype">bool</span>    freeforall        : 1;                          <span class="comment">// free for all</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <span class="keywordtype">bool</span>    is_underthreshold : 1;</div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordtype">bool</span>    is_counted        : 1;</div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordtype">bool</span>    needs_quest       : 1;                          <span class="comment">// quest drop</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="classObjectGuid.html">ObjectGuid</a> lootOwner;           <span class="comment">// Roll winner player guid, in case of full inventory</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="comment">// Constructor, copies most fields from LootStoreItem, generates random count and random suffixes/properties</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="comment">// Should be called for non-reference LootStoreItem entries only (mincountOrRef &gt; 0)</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="keyword">explicit</span> <a class="code" href="structLootItem.html">LootItem</a>(<a class="code" href="structLootStoreItem.html">LootStoreItem</a> <span class="keyword">const</span>&amp; li);</div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    <a class="code" href="structLootItem.html">LootItem</a>(uint32 itemid_, uint32 count_, int32 randomPropertyId_ = 0);</div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;</div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">// Basic checks for player/item compatibility - if false no chance to see the item in the loot</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="keywordtype">bool</span> AllowedForPlayer(<a class="code" href="classPlayer.html">Player</a> <span class="keyword">const</span>* player, <a class="code" href="classWorldObject.html">WorldObject</a> <span class="keyword">const</span>* lootTarget) <span class="keyword">const</span>;</div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    LootSlotType GetSlotTypeForSharedLoot(PermissionTypes permission, <a class="code" href="classPlayer.html">Player</a>* viewer, <a class="code" href="classWorldObject.html">WorldObject</a> <span class="keyword">const</span>* lootTarget, <span class="keywordtype">bool</span> condition_ok = <span class="keyword">false</span>) <span class="keyword">const</span>;</div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;};</div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="keyword">typedef</span> std::vector&lt;LootItem&gt; LootItemList;</div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div><div class="line"><a name="l00142"></a><span class="lineno"><a class="line" href="structQuestItem.html">  142</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structQuestItem.html">QuestItem</a></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;{</div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    uint8   index;                                          <span class="comment">// position in quest_items;</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    <span class="keywordtype">bool</span>    is_looted;</div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    <a class="code" href="structQuestItem.html">QuestItem</a>()</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        : index(0), is_looted(<span class="keyword">false</span>) {}</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <a class="code" href="structQuestItem.html">QuestItem</a>(uint8 _index, <span class="keywordtype">bool</span> _islooted = <span class="keyword">false</span>)</div><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;        : index(_index), is_looted(_islooted) {}</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;};</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="keyword">class </span><a class="code" href="classLootTemplate.html">LootTemplate</a>;</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="keyword">typedef</span> std::vector&lt;QuestItem&gt; QuestItemList;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="keyword">typedef</span> std::map&lt;uint32, QuestItemList *&gt; QuestItemMap;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;<span class="keyword">typedef</span> std::vector&lt;LootStoreItem&gt; LootStoreItemList;</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="keyword">typedef</span> UNORDERED_MAP&lt;uint32, LootTemplate*&gt; LootTemplateMap;</div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="keyword">typedef</span> std::set&lt;uint32&gt; LootIdSet;</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="classLootStore.html">  163</a></span>&#160;<span class="keyword">class </span><a class="code" href="classLootStore.html">LootStore</a></div><div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;{</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="keyword">explicit</span> <a class="code" href="classLootStore.html">LootStore</a>(<span class="keywordtype">char</span> <span class="keyword">const</span>* name, <span class="keywordtype">char</span> <span class="keyword">const</span>* entryName, <span class="keywordtype">bool</span> ratesAllowed)</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            : m_name(name), m_entryName(entryName), m_ratesAllowed(ratesAllowed) {}</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="keyword">virtual</span> ~<a class="code" href="classLootStore.html">LootStore</a>() { Clear(); }</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <span class="keywordtype">void</span> Verify() <span class="keyword">const</span>;</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;        <span class="keywordtype">void</span> LoadAndCollectLootIds(LootIdSet&amp; ids_set);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;        <span class="keywordtype">void</span> CheckLootRefs(LootIdSet* ref_set = NULL) <span class="keyword">const</span>;<span class="comment">// check existence reference and remove it from ref_set</span></div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;        <span class="keywordtype">void</span> ReportUnusedIds(LootIdSet <span class="keyword">const</span>&amp; ids_set) <span class="keyword">const</span>;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;        <span class="keywordtype">void</span> ReportNotExistedId(uint32 <span class="keywordtype">id</span>) <span class="keyword">const</span>;</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;        <span class="keywordtype">bool</span> HaveLootFor(uint32 loot_id)<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_LootTemplates.find(loot_id) != m_LootTemplates.end(); }</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordtype">bool</span> HaveQuestLootFor(uint32 loot_id) <span class="keyword">const</span>;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordtype">bool</span> HaveQuestLootForPlayer(uint32 loot_id,<a class="code" href="classPlayer.html">Player</a>* player) <span class="keyword">const</span>;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;        <a class="code" href="classLootTemplate.html">LootTemplate</a> <span class="keyword">const</span>* GetLootFor(uint32 loot_id) <span class="keyword">const</span>;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;        <span class="keywordtype">char</span> <span class="keyword">const</span>* GetName()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_name; }</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        <span class="keywordtype">char</span> <span class="keyword">const</span>* GetEntryName()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_entryName; }</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordtype">bool</span> IsRatesAllowed()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_ratesAllowed; }</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keyword">protected</span>:</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;        <span class="keywordtype">void</span> LoadLootTable();</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;        <span class="keywordtype">void</span> Clear();</div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        LootTemplateMap m_LootTemplates;</div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;        <span class="keywordtype">char</span> <span class="keyword">const</span>* m_name;</div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;        <span class="keywordtype">char</span> <span class="keyword">const</span>* m_entryName;</div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        <span class="keywordtype">bool</span> m_ratesAllowed;</div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;};</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div><div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="classLootTemplate.html">  196</a></span>&#160;<span class="keyword">class </span><a class="code" href="classLootTemplate.html">LootTemplate</a></div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;{</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <span class="keyword">class  </span><a class="code" href="classLootTemplate_1_1LootGroup.html">LootGroup</a>;                                       <span class="comment">// A set of loot definitions for items (refs are not allowed inside)</span></div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="keyword">typedef</span> std::vector&lt;LootGroup&gt; LootGroups;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// Adds an entry to the group (at loading stage)</span></div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordtype">void</span> AddEntry(<a class="code" href="structLootStoreItem.html">LootStoreItem</a>&amp; item);</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">// Rolls for every item in the template and adds the rolled items the the loot</span></div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <span class="keywordtype">void</span> Process(<a class="code" href="structLoot.html">Loot</a>&amp; loot, <a class="code" href="classLootStore.html">LootStore</a> <span class="keyword">const</span>&amp; store, <span class="keywordtype">bool</span> rate, uint8 GroupId = 0) <span class="keyword">const</span>;</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        <span class="comment">// True if template includes at least 1 quest drop entry</span></div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordtype">bool</span> HasQuestDrop(LootTemplateMap <span class="keyword">const</span>&amp; store, uint8 GroupId = 0) <span class="keyword">const</span>;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <span class="comment">// True if template includes at least 1 quest drop for an active quest of the player</span></div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordtype">bool</span> HasQuestDropForPlayer(LootTemplateMap <span class="keyword">const</span>&amp; store, <a class="code" href="classPlayer.html">Player</a> <span class="keyword">const</span> * player, uint8 GroupId = 0) <span class="keyword">const</span>;</div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        <span class="comment">// Checks integrity of the template</span></div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        <span class="keywordtype">void</span> Verify(<a class="code" href="classLootStore.html">LootStore</a> <span class="keyword">const</span>&amp; store, uint32 Id) <span class="keyword">const</span>;</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        <span class="keywordtype">void</span> CheckLootRefs(LootIdSet* ref_set) <span class="keyword">const</span>;</div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        LootStoreItemList Entries;                          <span class="comment">// not grouped only</span></div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        LootGroups        Groups;                           <span class="comment">// groups have own (optimised) processing, grouped entries go there</span></div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;};</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment">//=====================================================</span></div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div><div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="classLootValidatorRef.html">  222</a></span>&#160;<span class="keyword">class </span><a class="code" href="classLootValidatorRef.html">LootValidatorRef</a> :  <span class="keyword">public</span> <a class="code" href="classReference.html">Reference</a>&lt;Loot, LootValidatorRef&gt;</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;{</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        <a class="code" href="classLootValidatorRef.html">LootValidatorRef</a>() {}</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        <span class="keywordtype">void</span> targetObjectDestroyLink() {}</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;        <span class="keywordtype">void</span> sourceObjectDestroyLink() {}</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;};</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;</div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">//=====================================================</span></div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;</div><div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="classLootValidatorRefManager.html">  232</a></span>&#160;<span class="keyword">class </span><a class="code" href="classLootValidatorRefManager.html">LootValidatorRefManager</a> : <span class="keyword">public</span> <a class="code" href="classRefManager.html">RefManager</a>&lt;Loot, LootValidatorRef&gt;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;{</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <span class="keyword">public</span>:</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        <span class="keyword">typedef</span> <a class="code" href="classLinkedListHead_1_1Iterator.html">LinkedListHead::Iterator&lt; LootValidatorRef &gt;</a> <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a>;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <a class="code" href="classLootValidatorRef.html">LootValidatorRef</a>* getFirst() { <span class="keywordflow">return</span> (<a class="code" href="classLootValidatorRef.html">LootValidatorRef</a>*)<a class="code" href="classRefManager.html">RefManager&lt;Loot, LootValidatorRef&gt;::getFirst</a>(); }</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="classLootValidatorRef.html">LootValidatorRef</a>* getLast() { <span class="keywordflow">return</span> (<a class="code" href="classLootValidatorRef.html">LootValidatorRef</a>*)<a class="code" href="classRefManager.html">RefManager&lt;Loot, LootValidatorRef&gt;::getLast</a>(); }</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a> begin() { <span class="keywordflow">return</span> <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a>(getFirst()); }</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a> end() { <span class="keywordflow">return</span> <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a>(NULL); }</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a> rbegin() { <span class="keywordflow">return</span> <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a>(getLast()); }</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a> rend() { <span class="keywordflow">return</span> <a class="code" href="classLinkedListHead_1_1Iterator.html">iterator</a>(NULL); }</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;};</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="comment">//=====================================================</span></div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keyword">struct </span><a class="code" href="structLootView.html">LootView</a>;</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<a class="code" href="classByteBuffer.html">ByteBuffer</a>&amp; operator&lt;&lt;(<a class="code" href="classByteBuffer.html">ByteBuffer</a>&amp; b, <a class="code" href="structLootItem.html">LootItem</a> <span class="keyword">const</span>&amp; li);</div><div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<a class="code" href="classByteBuffer.html">ByteBuffer</a>&amp; operator&lt;&lt;(<a class="code" href="classByteBuffer.html">ByteBuffer</a>&amp; b, <a class="code" href="structLootView.html">LootView</a> <span class="keyword">const</span>&amp; lv);</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div><div class="line"><a name="l00252"></a><span class="lineno"><a class="line" href="structLoot.html">  252</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structLoot.html">Loot</a></div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keyword">friend</span> <a class="code" href="classByteBuffer.html">ByteBuffer</a>&amp; operator&lt;&lt;(<a class="code" href="classByteBuffer.html">ByteBuffer</a>&amp; b, <a class="code" href="structLootView.html">LootView</a> <span class="keyword">const</span>&amp; lv);</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    QuestItemMap <span class="keyword">const</span>&amp; GetPlayerQuestItems()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_playerQuestItems; }</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    QuestItemMap <span class="keyword">const</span>&amp; GetPlayerFFAItems()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_playerFFAItems; }</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    QuestItemMap <span class="keyword">const</span>&amp; GetPlayerNonQuestNonFFAConditionalItems()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_playerNonQuestNonFFAConditionalItems; }</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordtype">bool</span> _personal;</div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    LootItemList items;</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    uint32 gold;</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    uint8 unlootedCount;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    uint64 roundRobinPlayer;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    LootType loot_type;                                     <span class="comment">// required for for proper item loot finish (store internal loot types in different from 3.x version, in fact this meaning that it send same loot types for interesting cases like 3.x version code, skip pre-3.x client loot type limitaitons)</span></div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <a class="code" href="structLoot.html">Loot</a>(<a class="code" href="classWorldObject.html">WorldObject</a> <span class="keyword">const</span>* lootTarget, uint32 _gold = 0) :</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;        _personal(<span class="keyword">false</span>),</div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;        gold(_gold),</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        unlootedCount(0),</div><div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        m_lootTarget(lootTarget),</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        loot_type(LOOT_CORPSE),</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;        roundRobinPlayer(0),</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;        _groupTeam(TEAM_CROSSFACTION)</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    {</div><div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    }</div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    ~<a class="code" href="structLoot.html">Loot</a>() { clear(); }</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    <span class="comment">// if loot becomes invalid this reference is used to inform the listener</span></div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    <span class="keywordtype">void</span> addLootValidatorRef(<a class="code" href="classLootValidatorRef.html">LootValidatorRef</a>* pLootValidatorRef)</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;    {</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        m_LootValidatorRefManager.insertFirst(pLootValidatorRef);</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    }</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    <span class="comment">// void clear()</span></div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    <span class="keywordtype">void</span> clear(<span class="keywordtype">bool</span> clearQuestItems = <span class="keyword">true</span>)</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    {</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    <span class="keywordflow">if</span> (clearQuestItems)</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    {</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="keywordflow">for</span> (QuestItemMap::const_iterator itr = m_playerQuestItems.begin(); itr != m_playerQuestItems.end(); ++itr)</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                <span class="keyword">delete</span> itr-&gt;second;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            m_playerQuestItems.clear();</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            m_questItems.clear();</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    }</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">for</span> (QuestItemMap::const_iterator itr = m_playerFFAItems.begin(); itr != m_playerFFAItems.end(); ++itr)</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keyword">delete</span> itr-&gt;second;</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;        m_playerFFAItems.clear();</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;        <span class="keywordflow">for</span> (QuestItemMap::const_iterator itr = m_playerNonQuestNonFFAConditionalItems.begin(); itr != m_playerNonQuestNonFFAConditionalItems.end(); ++itr)</div><div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            <span class="keyword">delete</span> itr-&gt;second;</div><div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;        m_playerNonQuestNonFFAConditionalItems.clear();</div><div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div><div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        m_playersLooting.clear();</div><div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        items.clear();</div><div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;        gold = 0;</div><div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        unlootedCount = 0;</div><div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        m_LootValidatorRefManager.clearReferences();</div><div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        roundRobinPlayer = 0;</div><div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;        _allowedLooters.clear();</div><div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;        _personal = <span class="keyword">true</span>;</div><div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        _groupTeam = TEAM_CROSSFACTION;</div><div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    }</div><div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;</div><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    <span class="keywordtype">void</span> leaveOnlyQuestItems()</div><div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    {</div><div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;       clear(<span class="keyword">false</span>);</div><div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    }</div><div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;</div><div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;    <span class="keywordtype">bool</span> empty()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> items.empty() &amp;&amp; m_questItems.empty() &amp;&amp; gold == 0; }</div><div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="keywordtype">bool</span> isLooted()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> gold == 0 &amp;&amp; unlootedCount == 0; }</div><div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;</div><div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordtype">void</span> NotifyItemRemoved(uint8 lootIndex);</div><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <span class="keywordtype">void</span> NotifyQuestItemRemoved(uint8 questIndex);</div><div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <span class="keywordtype">void</span> NotifyMoneyRemoved();</div><div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <span class="keywordtype">void</span> AddLooter(<a class="code" href="classObjectGuid.html">ObjectGuid</a> guid) { m_playersLooting.insert(guid); }</div><div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <span class="keywordtype">void</span> RemoveLooter(<a class="code" href="classObjectGuid.html">ObjectGuid</a> guid) { m_playersLooting.erase(guid); }</div><div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div><div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <span class="keywordtype">void</span> generateMoneyLoot(uint32 minAmount, uint32 maxAmount);</div><div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <span class="keywordtype">bool</span> FillLoot(uint32 loot_id, <a class="code" href="classLootStore.html">LootStore</a> <span class="keyword">const</span>&amp; store, <a class="code" href="classPlayer.html">Player</a>* loot_owner, <span class="keywordtype">bool</span> personal, <span class="keywordtype">bool</span> noEmptyError = <span class="keyword">false</span>, <a class="code" href="classWorldObject.html">WorldObject</a> <span class="keyword">const</span>* looted = NULL);</div><div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div><div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <span class="comment">// Inserts the item into the loot (called by LootTemplate processors)</span></div><div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <span class="keywordtype">void</span> AddItem(<a class="code" href="structLootStoreItem.html">LootStoreItem</a> <span class="keyword">const</span> &amp; item);</div><div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div><div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <a class="code" href="structLootItem.html">LootItem</a>* LootItemInSlot(uint32 lootslot, uint32 playerGuid, <a class="code" href="structQuestItem.html">QuestItem</a>** qitem = NULL, <a class="code" href="structQuestItem.html">QuestItem</a>** ffaitem = NULL, <a class="code" href="structQuestItem.html">QuestItem</a>** conditem = NULL);</div><div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;    uint32 GetMaxSlotInLootFor(uint32 playerGuid) <span class="keyword">const</span>;</div><div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;</div><div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <a class="code" href="classWorldObject.html">WorldObject</a> <span class="keyword">const</span>* GetLootTarget()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> m_lootTarget; }</div><div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div><div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="comment">// TrinityCore</span></div><div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    <span class="keywordtype">bool</span> hasItemFor(<a class="code" href="classPlayer.html">Player</a>* player) <span class="keyword">const</span>;</div><div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <span class="keywordtype">bool</span> hasOverThresholdItem() <span class="keyword">const</span>;</div><div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;    <span class="keywordtype">bool</span> IsAllowedLooter(<a class="code" href="classObjectGuid.html">ObjectGuid</a> guid, <span class="keywordtype">bool</span> doPersonalCheck = <span class="keyword">true</span>) <span class="keyword">const</span>;</div><div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    <span class="keywordtype">bool</span> IsOriginalLooter(<a class="code" href="classObjectGuid.html">ObjectGuid</a> guid) { <span class="keywordflow">return</span> IsAllowedLooter(guid, <span class="keyword">false</span>); }</div><div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;</div><div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <span class="keywordtype">void</span> FillNotNormalLootFor(<a class="code" href="classPlayer.html">Player</a>* player);</div><div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div><div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    uint32 GetTeam()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _groupTeam; }</div><div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;    <span class="keywordtype">void</span> SetTeam(Team team) { _groupTeam = team; }</div><div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;</div><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    LootItemList m_questItems;</div><div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    QuestItemMap m_playerQuestItems;</div><div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;    QuestItemMap m_playerFFAItems;</div><div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    QuestItemMap m_playerNonQuestNonFFAConditionalItems;</div><div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keyword">private</span>:</div><div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;        QuestItemList* FillFFALoot(<a class="code" href="classPlayer.html">Player</a>* player);</div><div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        QuestItemList* FillQuestLoot(<a class="code" href="classPlayer.html">Player</a>* player);</div><div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        QuestItemList* FillNonQuestNonFFAConditionalLoot(<a class="code" href="classPlayer.html">Player</a>* player);</div><div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div><div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        <span class="keyword">typedef</span> std::set&lt;ObjectGuid&gt; PlayersLooting;</div><div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;        PlayersLooting m_playersLooting;</div><div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div><div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        <span class="comment">// All rolls are registered here. They need to know, when the loot is not valid anymore</span></div><div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;        <a class="code" href="classLootValidatorRefManager.html">LootValidatorRefManager</a> m_LootValidatorRefManager;</div><div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;        std::vector&lt;ObjectGuid&gt; _allowedLooters;</div><div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;</div><div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;        <span class="comment">// What is looted</span></div><div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        <a class="code" href="classWorldObject.html">WorldObject</a> <span class="keyword">const</span>* m_lootTarget;</div><div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        Team _groupTeam;</div><div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;};</div><div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div><div class="line"><a name="l00372"></a><span class="lineno"><a class="line" href="structLootView.html">  372</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structLootView.html">LootView</a></div><div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;{</div><div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    <a class="code" href="structLoot.html">Loot</a> &amp;loot;</div><div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <a class="code" href="classPlayer.html">Player</a> *viewer;</div><div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    PermissionTypes permission;</div><div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    <a class="code" href="structLootView.html">LootView</a>(<a class="code" href="structLoot.html">Loot</a> &amp;_loot, <a class="code" href="classPlayer.html">Player</a> *_viewer,PermissionTypes _permission = ALL_PERMISSION)</div><div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        : loot(_loot), viewer(_viewer), permission(_permission) {}</div><div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;};</div><div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div><div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Creature;</div><div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Fishing;</div><div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Gameobject;</div><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Item;</div><div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Mail;</div><div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Pickpocketing;</div><div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Skinning;</div><div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Disenchant;</div><div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="keyword">extern</span> <a class="code" href="classLootStore.html">LootStore</a> LootTemplates_Reference;</div><div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;</div><div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Creature();</div><div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Fishing();</div><div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Gameobject();</div><div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Item();</div><div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Mail();</div><div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Pickpocketing();</div><div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Skinning();</div><div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Disenchant();</div><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;</div><div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordtype">void</span> LoadLootTemplates_Reference();</div><div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;</div><div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;<span class="keyword">inline</span> <span class="keywordtype">void</span> LoadLootTables()</div><div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;{</div><div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    LoadLootTemplates_Creature();</div><div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    LoadLootTemplates_Fishing();</div><div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    LoadLootTemplates_Gameobject();</div><div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    LoadLootTemplates_Item();</div><div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    LoadLootTemplates_Mail();</div><div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    LoadLootTemplates_Pickpocketing();</div><div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    LoadLootTemplates_Skinning();</div><div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    LoadLootTemplates_Disenchant();</div><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div><div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    LoadLootTemplates_Reference();</div><div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;}</div><div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;</div><div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;<span class="preprocessor">#endif</span></div><div class="ttc" id="structLootView_html"><div class="ttname"><a href="structLootView.html">LootView</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:372</div></div>
<div class="ttc" id="classByteBuffer_html"><div class="ttname"><a href="classByteBuffer.html">ByteBuffer</a></div><div class="ttdef"><b>Definition:</b> ByteBuffer.h:56</div></div>
<div class="ttc" id="classLootValidatorRef_html"><div class="ttname"><a href="classLootValidatorRef.html">LootValidatorRef</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:222</div></div>
<div class="ttc" id="structQuestItem_html"><div class="ttname"><a href="structQuestItem.html">QuestItem</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:142</div></div>
<div class="ttc" id="structLootStoreItem_html"><div class="ttname"><a href="structLootStoreItem.html">LootStoreItem</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:91</div></div>
<div class="ttc" id="classWorldObject_html"><div class="ttname"><a href="classWorldObject.html">WorldObject</a></div><div class="ttdef"><b>Definition:</b> Object.h:634</div></div>
<div class="ttc" id="classRefManager_html"><div class="ttname"><a href="classRefManager.html">RefManager</a></div><div class="ttdef"><b>Definition:</b> RefManager.h:31</div></div>
<div class="ttc" id="classRoll_html"><div class="ttname"><a href="classRoll.html">Roll</a></div><div class="ttdef"><b>Definition:</b> Group.h:139</div></div>
<div class="ttc" id="classLootValidatorRefManager_html"><div class="ttname"><a href="classLootValidatorRefManager.html">LootValidatorRefManager</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:232</div></div>
<div class="ttc" id="structLoot_html"><div class="ttname"><a href="structLoot.html">Loot</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:252</div></div>
<div class="ttc" id="classReference_html"><div class="ttname"><a href="classReference.html">Reference</a></div><div class="ttdef"><b>Definition:</b> Reference.h:30</div></div>
<div class="ttc" id="classLinkedListHead_1_1Iterator_html"><div class="ttname"><a href="classLinkedListHead_1_1Iterator.html">LinkedListHead::Iterator</a></div><div class="ttdef"><b>Definition:</b> LinkedList.h:148</div></div>
<div class="ttc" id="classLootTemplate_1_1LootGroup_html"><div class="ttname"><a href="classLootTemplate_1_1LootGroup.html">LootTemplate::LootGroup</a></div><div class="ttdef"><b>Definition:</b> LootMgr.cpp:51</div></div>
<div class="ttc" id="structLootItem_html"><div class="ttname"><a href="structLootItem.html">LootItem</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:115</div></div>
<div class="ttc" id="classLootTemplate_html"><div class="ttname"><a href="classLootTemplate.html">LootTemplate</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:196</div></div>
<div class="ttc" id="classLootStore_html"><div class="ttname"><a href="classLootStore.html">LootStore</a></div><div class="ttdef"><b>Definition:</b> LootMgr.h:163</div></div>
<div class="ttc" id="classObjectGuid_html"><div class="ttname"><a href="classObjectGuid.html">ObjectGuid</a></div><div class="ttdef"><b>Definition:</b> ObjectGuid.h:126</div></div>
<div class="ttc" id="classPlayer_html"><div class="ttname"><a href="classPlayer.html">Player</a></div><div class="ttdef"><b>Definition:</b> Player.h:871</div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
